%% File description
% Name : eeng_plant_gasoline_1pt6L_engine_turbo			
% Author : IAV		                          				
% Description : Initialize the 1.6 L engine map from IAV 


%Proprietary : VMS
%Protected: false


% Model : eng_plant_hot_map													
% Technology : si																		
% Vehicle Type : Light

%% Conversion constants
pxfUnitConversion.rpm2radps = pi/30;
pxfUnitConversion.gallon2liter = 3.78541;
%% File content
eng.plant.init.technology                   = 'si';
eng.plant.init.type                         = 'eng12';
eng.plant.init.cyl_config                   = 'inline';
eng.plant.init.cam_shaft_config             = 'dohc';
eng.plant.init.num_cyl_init                 = 4;
eng.plant.init.num_cyl_banks                = 1;
eng.plant.init.has_variable_valve_timing    = true;
eng.plant.init.has_variable_valve_lift      = true;
eng.plant.init.valvetrain                   = 'VVT VVL'; % 'VVT' or 'VVL' or 'VVT VVL'
eng.plant.init.has_direct_injec             = true;
eng.plant.init.injection_type               = 'DI'; %PFI or DI
eng.plant.init.has_turbo                    = true;
eng.plant.init.boost_level                  = 1.5271;
eng.plant.init.has_EGR                      = true;
eng.plant.init.EGR_type                     = 'Hot EGR'; % 'No EGR' or 'Cooled EGR' or 'Hot EGR'
eng.plant.init.has_cyl_deac                 = false;
eng.plant.init.material                     = 'Aluminum'; %Assumption
eng.plant.init.has_hcci                     = false;

eng.plant.init.fuel_density_val           = 0.741;          % kg/L
eng.plant.init.fuel_heating_val      	    = 43051000;    % (J/kg)Specific LHV
eng.plant.init.fuel_carbon_ratio  	    = 0.8696;      % (kg/kg) ref:Dr. Rob Thring

eng.plant.init.mass.eng                   = 140;%estimated eng.plant.init.mass_block + eng.plant.init.mass_radiator + eng.plant.init.mass_vol + eng.plant.init.mass.tank;
eng.plant.init.mass.tank                  = 20;
eng.plant.init.mass.fuel                  = (15.*pxfUnitConversion.gallon2liter)*eng.plant.init.fuel_density_val;%Capacity of tank in kg - approximate value
				
eng.plant.init.time_response              = 0.3; 						
eng.plant.init.spd_idle		 			= (650.*pxfUnitConversion.rpm2radps);   % rad/s (default)
eng.plant.init.spd_idle_offset		 	= 0;  % this can be used to implement a higher idle speed for performance tests
eng.plant.init.warmup_init				= 0;							% This should normally by 0
eng.plant.init.pwr_max				    = 131972;					% Watts
eng.plant.init.ex_gas_heat_cap            = 1089;            % J/kgK  ave sens heat cap of exh gas (SAE #890798)

eng.plant.init.displ_init					= 1600;		% cc
eng.plant.init.inertia					= 0.2	;		% kg-m^2 - approximate value
eng.plant.init.spd_str					= 10; % speed level (rad/s) the engine crank has to reach in order to start 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Time constant for turbo response
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.turbo_time_response.idx1_spd = 3.14/30.*[750 1000 1250 1500 1750 2000 2250 2500 2750 3000 3250 3500 3750 4000 4250 4500 5000 6000 6500];
eng.plant.init.turbo_time_response.map      = 1./[4 5 6.2 9.5 4.8 3 2.2 2 1.7 1.45 0.8 0.7 0.6 0.4 0.4 0.4 0.4 0.4 0.4];


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% max torque curve
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

eng.plant.init.trq_max_hot.idx1_spd = [104.72,157.08,209.44,261.80,314.16,366.52,418.88,471.24,523.60,575.96]; % rad/s 
eng.plant.init.trq_max_hot.map = [152.94,229.08,229.87,229.10,229.20,229.56,229.26,229.24,229.24,229.22]; % Nm 

eng.plant.init.trq_max_na_hot.idx1_spd = [104.67,157.00,209.33,261.67,314.00,366.33,418.67,471.00,523.33,575.67,628,680]; % rad/s 
eng.plant.init.trq_max_na_hot.map      = [143.84,150.45,157.27,173.24,167.11,168.73,181.02,177.95,181.22,179.35,170.38,159.62].*(eng.plant.init.displ_init/2000); % The NA limits are from a 2L engine
% Mid speed is used in logic to limit closed and wide open torque curves
eng.plant.init.spd_avg	= 0.5 * (eng.plant.init.trq_max_hot.idx1_spd(1) + eng.plant.init.trq_max_hot.idx1_spd(length(eng.plant.init.trq_max_hot.idx1_spd)));

% %% minimum torque with fuel curves
% eng.plant.init.trq_min_hot.idx1_spd = (3.14/30).*[0 1000,1500,2000,2500,3000,4000,5000,6000];
% eng.plant.init.trq_min_hot.idx2_trq = [0 -13.95, -13.91, -14.15,-14.61,-15.30,-17.38,-20.29,-24.17].*eng.plant.init.displ_init/2000;
% eng.plant.init.trq_min_hot.map      = eng.plant.init.trq_min_hot.idx2_trq;
% eng.plant.init.trq_min_hot_fuel.map = [0 0.514, 0.771, 1.028,1.285,1.542,2.056,2.57,3.084]./3600; % kg/hr to kg/s

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% consumption table
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

eng.plant.init.fuel_hot.idx1_spd = [ 104.72, 122.77, 140.83, 158.89, 176.94, 195.00, 213.05, 231.11, 249.16, 267.22, 285.27, 303.33, 321.38, 339.44, 357.49, 375.55, 393.60, 411.66, 429.71, 447.77, 465.82, 483.88, 501.93, 519.99, 538.04, 556.10, 574.15, 592.21, 610.26, 628.32,]; % rad/s 
eng.plant.init.fuel_hot.idx2_trq = [ -0.00,  5.89, 11.78, 17.68, 23.57, 29.47, 35.36, 41.26, 47.15, 53.04, 58.94, 64.83, 70.73, 76.62, 82.52, 88.41, 94.30, 100.20, 106.09, 111.99, 117.88, 123.78, 129.67, 135.56, 141.46, 147.35, 153.25, 159.14, 165.04, 170.93, 176.82, 182.72, 188.61, 194.51, 200.40, 206.30, 212.19, 218.08, 223.98, 229.87,]; % Nm 
% Rows represent speed (rad/s).  Columns represent torque (N-m).  Table is Fuel Rate (kg/s) 
eng.plant.init.fuel_hot.map = [...
 1.0256, 1.4616, 1.8917, 2.3006, 2.6979, 3.0880, 3.4792, 3.8721, 4.2672, 4.6577, 5.0394, 5.4318, 5.8330, 6.2215, 6.5605, 6.8932, 7.2494, 7.6557, 8.1431, 8.7102, 9.3418, 10.0079, 10.6735, 11.3515, 12.0266, 12.6514, 13.1388, 13.3612, 13.5068, 13.7040, 14.0419, 14.5794, 15.3582, 16.3990, 17.6993, 19.2366, 20.9713, 22.8498, 24.8105, 26.8007;...
 1.2362, 1.7061, 2.1654, 2.6053, 3.0304, 3.4508, 3.8753, 4.3093, 4.7550, 5.2123, 5.6764, 6.1441, 6.6091, 7.0635, 7.5026, 7.9381, 8.3851, 8.8574, 9.3659, 9.9147, 10.5039, 11.1347, 11.8077, 12.5082, 13.2005, 13.8298, 14.3397, 14.7059, 14.9924, 15.2951, 15.7102, 16.3110, 17.1259, 18.1539, 19.3823, 20.7973, 22.3837, 24.1176, 25.9569, 27.8404;...
 1.4450, 1.9571, 2.4540, 2.9224, 3.3743, 3.8286, 4.2921, 4.7723, 5.2707, 5.7939, 6.3352, 6.8759, 7.4063, 7.9303, 8.4578, 8.9862, 9.5167, 10.0513, 10.5884, 11.1340, 11.6970, 12.2967, 12.9700, 13.6968, 14.4145, 15.0707, 15.6366, 16.1102, 16.5175, 16.9165, 17.3957, 18.0632, 18.9172, 19.9289, 21.0820, 22.3727, 23.8034, 25.3769, 27.0801, 28.8506;...
 1.6608, 2.2191, 2.7591, 3.2589, 3.7422, 4.2396, 4.7537, 5.2893, 5.8467, 6.4277, 7.0409, 7.6482, 8.2426, 8.8307, 9.4364, 10.0417, 10.6427, 11.2368, 11.8139, 12.3821, 12.9531, 13.5438, 14.2105, 14.9675, 15.7108, 16.4043, 17.0365, 17.6024, 18.1207, 18.6211, 19.1608, 19.8865, 20.7668, 21.7452, 22.8168, 23.9856, 25.2565, 26.6376, 28.1403, 29.7574;...
 1.9017, 2.4942, 3.0688, 3.6144, 4.1495, 4.7014, 5.2793, 5.8833, 6.5092, 7.1514, 7.8090, 8.4686, 9.1250, 9.7814, 10.4444, 11.1080, 11.7658, 12.4118, 13.0423, 13.6629, 14.2862, 14.9308, 15.6211, 16.3608, 17.1082, 17.8336, 18.5243, 19.1787, 19.8104, 20.4423, 21.1094, 21.8582, 22.6971, 23.6113, 24.5983, 25.6594, 26.7843, 27.9598, 29.1754, 30.4196;...
 2.1494, 2.7879, 3.4095, 3.9995, 4.5835, 5.1986, 5.8488, 6.5268, 7.2249, 7.9249, 8.6249, 9.3306, 10.0433, 10.7596, 11.4741, 12.1872, 12.8956, 13.5954, 14.2864, 14.9747, 15.6713, 16.3859, 17.1107, 17.8491, 18.6006, 19.3549, 20.1010, 20.8323, 21.5669, 22.3246, 23.1094, 23.8822, 24.6783, 25.5274, 26.4378, 27.4132, 28.4252, 29.4219, 30.3563, 31.2164;...
 2.4034, 3.0991, 3.7774, 4.4161, 5.0492, 5.7249, 6.4460, 7.1931, 7.9560, 8.7201, 9.4655, 10.2192, 10.9842, 11.7551, 12.5183, 13.2803, 14.0402, 14.7969, 15.5518, 16.3100, 17.0779, 17.8577, 18.6337, 19.3926, 20.1653, 20.9538, 21.7521, 22.5476, 23.3586, 24.2008, 25.0669, 25.8852, 26.6685, 27.4895, 28.3582, 29.2695, 30.2150, 31.1031, 31.8711, 32.4978;...
 2.6712, 3.4246, 4.1567, 4.8553, 5.5517, 6.2857, 7.0628, 7.8667, 8.6835, 9.5017, 10.3125, 11.1237, 11.9396, 12.7579, 13.5740, 14.3889, 15.2038, 16.0199, 16.8389, 17.6629, 18.4924, 19.3236, 20.1478, 20.9617, 21.7799, 22.6110, 23.4547, 24.3066, 25.1698, 26.0466, 26.9297, 27.7996, 28.6474, 29.4980, 30.3710, 31.2740, 32.1848, 33.0474, 33.8216, 34.5212;...
 2.9417, 3.7659, 4.5665, 5.3160, 6.0619, 6.8562, 7.6947, 8.5546, 9.4233, 10.2976, 11.1716, 12.0418, 12.9093, 13.7762, 14.6450, 15.5153, 16.3880, 17.2646, 18.1463, 19.0320, 19.9187, 20.8021, 21.6807, 22.5552, 23.4307, 24.3135, 25.2060, 26.1063, 27.0074, 27.9023, 28.7956, 29.7279, 30.6574, 31.5683, 32.4723, 33.3997, 34.3369, 35.2575, 36.1470, 37.0157;...
 3.2250, 4.1158, 4.9824, 5.7886, 6.5854, 7.4333, 8.3355, 9.2607, 10.1891, 11.1193, 12.0522, 12.9773, 13.8958, 14.8128, 15.7349, 16.6616, 17.5934, 18.5310, 19.4743, 20.4206, 21.3656, 22.3060, 23.2423, 24.1777, 25.1132, 26.0521, 26.9963, 27.9442, 28.8878, 29.8207, 30.7519, 31.7390, 32.7462, 33.7283, 34.6877, 35.6536, 36.6579, 37.6819, 38.7255, 39.7850;...
 3.5324, 4.4708, 5.3851, 6.2593, 7.1267, 8.0324, 8.9878, 9.9794, 10.9818, 11.9757, 12.9595, 13.9329, 14.9005, 15.8694, 16.8456, 17.8297, 18.8212, 19.8198, 20.8250, 21.8330, 22.8395, 23.8414, 24.8384, 25.8327, 26.8265, 27.8219, 28.8194, 29.8176, 30.8162, 31.8180, 32.8329, 33.8751, 34.9345, 35.9870, 37.0236, 38.0562, 39.1218, 40.2445, 41.4338, 42.6653;...
 3.8468, 4.8397, 5.8132, 6.7467, 7.6748, 8.6444, 9.6569, 10.7167, 11.7965, 12.8539, 13.8870, 14.9070, 15.9235, 16.9447, 17.9783, 19.0215, 20.0729, 21.1320, 22.2004, 23.2725, 24.3435, 25.4098, 26.4687, 27.5217, 28.5715, 29.6212, 30.6722, 31.7219, 32.7824, 33.8621, 34.9636, 36.0732, 37.1958, 38.3260, 39.4539, 40.5612, 41.6845, 42.8727, 44.1609, 45.5245;...
 4.1757, 5.2229, 6.2561, 7.2571, 8.2532, 9.2844, 10.3602, 11.4720, 12.6112, 13.7395, 14.8237, 15.8955, 16.9663, 18.0430, 19.1352, 20.2382, 21.3506, 22.4720, 23.6035, 24.7408, 25.8778, 27.0099, 28.1335, 29.2461, 30.3504, 31.4504, 32.5501, 33.6500, 34.7685, 35.9163, 37.0935, 38.2848, 39.4883, 40.7063, 41.9274, 43.1354, 44.3162, 45.5283, 46.8129, 48.1884;...
 4.5268, 5.6214, 6.7087, 7.7849, 8.8634, 9.9644, 11.0976, 12.2590, 13.4375, 14.6105, 15.7603, 16.8956, 18.0280, 19.1664, 20.3169, 21.4800, 22.6548, 23.8406, 25.0363, 26.2385, 27.4421, 28.6415, 29.8312, 31.0070, 32.1673, 33.3144, 34.4547, 35.5987, 36.7627, 37.9607, 39.1982, 40.4715, 41.7742, 43.0976, 44.4248, 45.7330, 47.0009, 48.2327, 49.4405, 50.6415;...
 4.8936, 6.0408, 7.1871, 8.3350, 9.4906, 10.6617, 11.8531, 13.0625, 14.2815, 15.4993, 16.7083, 17.9083, 19.1058, 20.3082, 21.5207, 22.7459, 23.9844, 25.2350, 26.4960, 27.7641, 29.0350, 30.3030, 31.5618, 32.8046, 34.0254, 35.2220, 36.3998, 37.5738, 38.7633, 39.9907, 41.2747, 42.6232, 44.0298, 45.4746, 46.9288, 48.3617, 49.7400, 51.0302, 52.2037, 53.2690;...
 5.2772, 6.4825, 7.6905, 8.9053, 10.1303, 11.3675, 12.6177, 13.8785, 15.1448, 16.4116, 17.6760, 18.9376, 20.1998, 21.4675, 22.7449, 24.0350, 25.3386, 26.6549, 27.9819, 29.3167, 30.6552, 31.9924, 33.3219, 34.6357, 35.9242, 37.1779, 38.3935, 39.5839, 40.7769, 42.0113, 43.3228, 44.7325, 46.2393, 47.8173, 49.4210, 51.0035, 52.5274, 53.9599, 55.2724, 56.4631;...
 5.6794, 6.9448, 8.2144, 9.4924, 10.7808, 12.0799, 13.3887, 14.7052, 16.0257, 17.3458, 18.6651, 19.9862, 21.3121, 22.6459, 23.9904, 25.3475, 26.7179, 28.1008, 29.4945, 30.8961, 32.3020, 33.7077, 35.1073, 36.4934, 37.8551, 39.1771, 40.4394, 41.6343, 42.8138, 44.0378, 45.3567, 46.8052, 48.3955, 50.1083, 51.8848, 53.6412, 55.3516, 57.0235, 58.6666, 60.2890;...
 6.0992, 7.4246, 8.7552, 10.0939, 11.4420, 12.7998, 14.1665, 15.5408, 16.9203, 18.2978, 19.6740, 21.0554, 22.4456, 23.8465, 25.2596, 26.6854, 28.1240, 29.5744, 31.0353, 32.5036, 33.9761, 35.4486, 36.9158, 38.3706, 39.8033, 41.1987, 42.5264, 43.7194, 44.8877, 46.1002, 47.4127, 48.8723, 50.5104, 52.3319, 54.2946, 56.2525, 58.1976, 60.1960, 62.2822, 64.4482;...
 6.5313, 7.9191, 9.3108, 10.7091, 12.1152, 13.5297, 14.9527, 16.3837, 17.8209, 19.2610, 20.6998, 22.1462, 23.6036, 25.0735, 26.5563, 28.0519, 29.5596, 31.0784, 32.6065, 34.1414, 35.6795, 37.2168, 38.7478, 40.2654, 41.7585, 43.2090, 44.5842, 45.8248, 47.0224, 48.2441, 49.5494, 50.9964, 52.6359, 54.4971, 56.5667, 58.7813, 61.0484, 63.4534, 66.0026, 68.6629;...
 6.9761, 8.4276, 9.8812, 11.3388, 12.8021, 14.2723, 15.7505, 17.2375, 18.7328, 20.2351, 21.7434, 23.2609, 24.7901, 26.3316, 27.8853, 29.4510, 31.0280, 32.6152, 34.2109, 35.8122, 37.4154, 39.0155, 40.6066, 42.1807, 43.7257, 45.2224, 46.6449, 47.9777, 49.2543, 50.5239, 51.8408, 53.2669, 54.8708, 56.7167, 58.8438, 61.2548, 63.9185, 66.8144, 69.8705, 72.9926;...
 7.4366, 8.9514, 10.4670, 11.9845, 13.5053, 15.0311, 16.5641, 18.1070, 19.6620, 21.2298, 22.8106, 24.4043, 26.0098, 27.6260, 29.2518, 30.8872, 32.5327, 34.1879, 35.8511, 37.5194, 39.1879, 40.8501, 42.4992, 44.1270, 45.7243, 47.2801, 48.7833, 50.2300, 51.6276, 52.9959, 54.3678, 55.7951, 57.3560, 59.1538, 61.2975, 63.8694, 66.9017, 70.3370, 74.0065, 77.7222;...
 7.9139, 9.4917, 11.0695, 12.6477, 14.2274, 15.8100, 17.3987, 18.9981, 20.6138, 22.2505, 23.9081, 25.5827, 27.2687, 28.9621, 30.6610, 32.3658, 34.0781, 35.8001, 37.5312, 39.2676, 41.0025, 42.7280, 44.4366, 46.1218, 47.7802, 49.4132, 51.0256, 52.6175, 54.1813, 55.7086, 57.2041, 58.6973, 60.2568, 62.0085, 64.1335, 66.8109, 70.1433, 74.1017, 78.5029, 83.0704;...
 8.4083, 10.0491, 11.6896, 13.3299, 14.9704, 16.6129, 18.2602, 19.9178, 21.5948, 23.3029, 25.0430, 26.8028, 28.5720, 30.3446, 32.1180, 33.8924, 35.6704, 37.4569, 39.2567, 41.0626, 42.8655, 44.6572, 46.4314, 48.1847, 49.9190, 51.6454, 53.3868, 55.1632, 56.9420, 58.6917, 60.3973, 62.0648, 63.7333, 65.5074, 67.6068, 70.3554, 73.8996, 78.2077, 83.2086, 88.6449;...
 8.9200, 10.6242, 12.3280, 14.0314, 15.7353, 17.4414, 19.1530, 20.8747, 22.6153, 24.3970, 26.2242, 28.0701, 29.9228, 31.7759, 33.6260, 35.4726, 37.3178, 39.1669, 41.0362, 42.9114, 44.7829, 46.6444, 48.4930, 50.3302, 52.1629, 54.0056, 55.8896, 57.8907, 59.9227, 61.9504, 63.9553, 65.9313, 67.8901, 69.8794, 72.0492, 74.9104, 78.5808, 82.8483, 87.8620, 93.6011;...
 9.4496, 11.2170, 12.9843, 14.7520, 16.5215, 18.2953, 20.0778, 21.8750, 23.6968, 25.5556, 27.4589, 29.3853, 31.3206, 33.2560, 35.1862, 37.1097, 39.0290, 40.9501, 42.8806, 44.8201, 46.7589, 48.6935, 50.6259, 52.5638, 54.5221, 56.5250, 58.6096, 60.8227, 63.1198, 65.4691, 67.8528, 70.2654, 72.7168, 75.2489, 77.9699, 81.0617, 84.6366, 88.4030, 92.3791, 96.6593;...
 9.9976, 11.8275, 13.6579, 15.4901, 17.3270, 19.1724, 21.0315, 22.9111, 24.8189, 26.7614, 28.7397, 30.7439, 32.7616, 34.7819, 36.7972, 38.8035, 40.8016, 42.7958, 44.7913, 46.7910, 48.7944, 50.8041, 52.8287, 54.8832, 56.9902, 59.1797, 61.4854, 63.9309, 66.5130, 69.2200, 72.0467, 74.9999, 78.1000, 81.3799, 84.8654, 88.5151, 92.1554, 95.4211, 98.0541, 100.1900;...
 10.5646, 12.4549, 14.3467, 16.2431, 18.1487, 20.0684, 22.0077, 23.9722, 25.9667, 27.9936, 30.0520, 32.1364, 34.2381, 36.3470, 38.4535, 40.5500, 42.6322, 44.7011, 46.7618, 48.8203, 50.8852, 52.9699, 55.0930, 57.2770, 59.5481, 61.9357, 64.4697, 67.1745, 70.0676, 73.1632, 76.4783, 80.0358, 83.8604, 87.9626, 92.3021, 96.7267, 100.9157, 104.3759, 106.5798, 107.5224;...
 11.1508, 13.0974, 15.0476, 17.0070, 18.9818, 20.9775, 22.9988, 25.0491, 27.1302, 29.2422, 31.3835, 33.5511, 35.7395, 37.9410, 40.1454, 42.3412, 44.5168, 46.6653, 48.7896, 50.9009, 53.0208, 55.1781, 57.4033, 59.7259, 62.1729, 64.7696, 67.5417, 70.5211, 73.7426, 77.2470, 81.0749, 85.2613, 89.8256, 94.7546, 99.9780, 105.3441, 110.5892, 115.3464, 119.2877, 122.4823;...
 11.7547, 13.7516, 15.7563, 17.7773, 19.8215, 21.8939, 23.9980, 26.1349, 28.3035, 30.5012, 32.7260, 34.9778, 37.2548, 39.5518, 41.8595, 44.1641, 46.4470, 48.6864, 50.8697, 53.0210, 55.1859, 57.4116, 59.7401, 62.2073, 64.8415, 67.6630, 70.6873, 73.9421, 77.4936, 81.4139, 85.7623, 90.5785, 95.8747, 101.6250, 107.7596, 114.1876, 120.8821, 127.8884, 135.2059, 142.7236;...
 12.3715, 14.4120, 16.4683, 18.5499, 20.6634, 22.8128, 25.0000, 27.2243, 29.4821, 31.7662, 34.0730, 36.4088, 38.7749, 41.1686, 43.5821, 46.0016, 48.4046, 50.7544, 52.9867, 55.1617, 57.3632, 59.6545, 62.0866, 64.7010, 67.5296, 70.5922, 73.8890, 77.4029, 81.2766, 85.6125, 90.4815, 95.9227, 101.9435, 108.5244, 115.6261, 123.1804, 131.4616, 141.1612, 152.6845, 165.7057;...
]/10000; % kg/s 

% Extend fuel map to below idle speed

if min(eng.plant.init.fuel_hot.idx1_spd) > 501*pi/30
    fuel_rate_at_500_rpm= zeros(1,length(eng.plant.init.fuel_hot.idx2_trq));
    for i =1:1:length(eng.plant.init.fuel_hot.idx2_trq)
        fuel_rate_at_500_rpm(1,i)= interp1(eng.plant.init.fuel_hot.idx1_spd,eng.plant.init.fuel_hot.map(:,i),500*pi/30,'linear','extrap');
    end

    eng.plant.init.fuel_hot.map         = [fuel_rate_at_500_rpm; eng.plant.init.fuel_hot.map];
    eng.plant.init.fuel_hot.idx1_spd	= [500*pi/30 eng.plant.init.fuel_hot.idx1_spd];    
end

% locate the minimum torque with fuel based on Willans lines

for i = 1:1:length(eng.plant.init.fuel_hot.idx1_spd)
    pp = spline(eng.plant.init.fuel_hot.map(i,:),eng.plant.init.fuel_hot.idx2_trq);
    eng.temp.plant.init.trq_min_hot.map(i) = ppval(pp,0.5/10000); 
end

pp1 = spline(eng.plant.init.fuel_hot.idx1_spd,eng.temp.plant.init.trq_min_hot.map);

for i=1:1:length(eng.plant.init.trq_max_hot.idx1_spd)
    eng.plant.init.trq_min_hot.map(i) = ppval(pp1,eng.plant.init.trq_max_hot.idx1_spd(i));
end

eng.plant.init.trq_min_hot.idx1_spd = eng.plant.init.trq_max_hot.idx1_spd;

if max(eng.plant.init.trq_min_hot.map) >0
    eng.plant.init.trq_min_hot.map = [0 -10*ones(1,size(eng.plant.init.trq_max_hot.idx1_spd,2)-1)];
    eng.temp.plant.init.trq_min_hot.map = interp1(eng.plant.init.trq_min_hot.idx1_spd, eng.plant.init.trq_min_hot.map, eng.plant.init.fuel_hot.idx1_spd,'linear','extrap');
end

clear pp pp1 ;

% Expand the map to the minimum torque with fuel curve

eng.temp.plant.init.trq_step = eng.plant.init.fuel_hot.idx2_trq(2)-eng.plant.init.fuel_hot.idx2_trq(1);
eng.temp.plant.init.trq_first_idx = eng.plant.init.fuel_hot.idx2_trq(1) - eng.temp.plant.init.trq_step;
temp_negative_torque_index = [eng.temp.plant.init.trq_first_idx:-eng.temp.plant.init.trq_step: min(eng.plant.init.trq_min_hot.map)];


temp_map = zeros(length(eng.plant.init.fuel_hot.idx1_spd),length(temp_negative_torque_index));
for i = 1:1:length(eng.plant.init.fuel_hot.idx1_spd)
    temp1_map(i,:)= [0 eng.plant.init.fuel_hot.map(i,:)];
end

for i =1:1:length(eng.plant.init.fuel_hot.idx2_trq)
    temp_trq_index(i)= eng.plant.init.fuel_hot.idx2_trq(end-i+1);
end

for i=1:1:length(eng.plant.init.fuel_hot.idx1_spd)
    for j = 1:1:length(eng.plant.init.fuel_hot.idx2_trq)
        temp2_map(i,j)= eng.plant.init.fuel_hot.map(i,end-j+1);
    end
end

for i=1:1:length(eng.plant.init.fuel_hot.idx1_spd)
      
    fuel_vector = interp1([temp_trq_index eng.temp.plant.init.trq_min_hot.map(i)],[temp2_map(i,:) temp1_map(i,1)],[eng.temp.plant.init.trq_first_idx:-eng.temp.plant.init.trq_step:eng.temp.plant.init.trq_min_hot.map(i)],'pchip');
    length_fuel_vector = length(fuel_vector);
    temp_map(i,:) = [fuel_vector zeros(1,length(temp_negative_torque_index)-length(fuel_vector))];
    clear fuel_vector;
end

if ~isempty(temp_negative_torque_index)
    eng.plant.init.fuel_hot.idx2_trq = [temp_negative_torque_index(end):eng.temp.plant.init.trq_step:temp_negative_torque_index(1) eng.plant.init.fuel_hot.idx2_trq];
    
    for i = 1:1: length(eng.plant.init.fuel_hot.idx1_spd)
        for j=1:1:length(temp_map(i,:))
            temp3_map(i,j) = temp_map(i,end+1-j);
        end
    end

    eng.plant.init.fuel_hot.map = [temp3_map eng.plant.init.fuel_hot.map];
end

eng.plant.init.trq_zero_fuel_hot.idx1_spd       = eng.plant.init.trq_max_hot.idx1_spd;
eng.plant.init.trq_zero_fuel_hot.map            = zeros(1,length(eng.plant.init.trq_max_hot.idx1_spd));

clear temp_negative_torque_index temp_map temp1_map length_fuel_vector temp2_map i j fuel_rate_at_500_rpm temp_trq_index temp2_map temp3_map

%Emissions in percentage of fuel rate (kg/s)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.co_hot.idx1_spd = eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.co_hot.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.co_hot.map       = zeros(length(eng.plant.init.co_hot.idx1_spd),length(eng.plant.init.co_hot.idx2_trq)); 

eng.plant.init.hc_hot.idx1_spd = eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.hc_hot.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.hc_hot.map       = zeros(length(eng.plant.init.hc_hot.idx1_spd),length(eng.plant.init.hc_hot.idx2_trq));

eng.plant.init.nox_hot.idx1_spd = eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.nox_hot.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.nox_hot.map       = zeros(length(eng.plant.init.nox_hot.idx1_spd),length(eng.plant.init.nox_hot.idx2_trq));

eng.plant.init.pm_hot.idx1_spd = eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.pm_hot.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.pm_hot.map       = zeros(length(eng.plant.init.hc_hot.idx1_spd), length(eng.plant.init.nox_hot.idx2_trq));

% O2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.o2_hot.idx1_spd = eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.o2_hot.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.o2_hot.map       = zeros(length(eng.plant.init.fuel_hot.idx1_spd),length(eng.plant.init.fuel_hot.idx2_trq));

% exhaust table
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.equiv_hot.idx1_spd = eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.equiv_hot.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.equiv_hot.map       =  ones(length(eng.plant.init.equiv_hot.idx1_spd),length(eng.plant.init.equiv_hot.idx2_trq));

% Heat rejection variable Presid data table
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.htrej_hot.idx1_spd = eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.htrej_hot.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.htrej_hot.map       = zeros(length(eng.plant.init.fuel_hot.idx1_spd),length(eng.plant.init.fuel_hot.idx2_trq));

% Heat Transfer
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
eng.plant.init.ex_gas_flow_hot.idx1_spd =   eng.plant.init.fuel_hot.idx1_spd;
eng.plant.init.ex_gas_flow_hot.idx2_trq =   eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.ex_gas_flow_hot.map       =   eng.plant.init.fuel_hot.map *(1+20);                  % g/s  ex gas flow map:  for CI engines, exflow=(fuel use)*[1 + (ave A/F ratio)]

%eng.plant.init.v0x\fuel use, thermal and emissions\thermal\fc heat net calculation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.ex_pwr.map = eng.plant.init.fuel_hot.idx1_spd'*eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.ex_temp.map = eng.plant.init.ex_pwr.map./(eng.plant.init.ex_gas_flow_hot.map *1089) + 20;  % W   EO ex gas temp = Q/(MF*cp) + Tamb (assumes engine tested ~20 C)
eng.plant.init.ex_temp.idx1_spd = eng.plant.init.fuel_hot.idx1_spd; 
eng.plant.init.ex_temp.idx2_trq = eng.plant.init.fuel_hot.idx2_trq;
eng.plant.init.temp_operating = 90;
eng.plant.init.ex_temp_operating = mean(mean(eng.plant.init.ex_temp.map));

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Calculations
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% maximum and minimum calculations
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.trq_max_hot.trq_max	= max(eng.plant.init.trq_max_hot.map); % N-m
[eng.plant.init.pwr_max_hot.pwr_max,Idx]  = max(eng.plant.init.trq_max_hot.idx1_spd.* eng.plant.init.trq_max_hot.map); % W
eng.plant.init.pwr_max_hot.map = eng.plant.init.trq_max_hot.idx1_spd.* eng.plant.init.trq_max_hot.map; % W

%Code to compute maximum speed of the engine. Speed at 80% of peak power.
eng.plant.init.spd_max =   eng.plant.init.trq_max_hot.idx1_spd(Idx);
if Idx < length(eng.plant.init.pwr_max_hot.map)
    eng.plant.init.spd_max = min(interp1(eng.plant.init.pwr_max_hot.map(Idx:end)+1e-6*(1:length(eng.plant.init.pwr_max_hot.map(Idx:end))),eng.plant.init.trq_max_hot.idx1_spd(Idx:end),eng.plant.init.pwr_max_hot.pwr_max * 0.80,'linear','extrap'),max(eng.plant.init.trq_max_hot.idx1_spd));
end

% Calculate the max engine efficiency in within the max torque curve
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
eng.plant.init.eff_hot_pwr.map    = eng.plant.init.fuel_hot.idx1_spd'*eng.plant.init.fuel_hot.idx2_trq/eng.plant.init.fuel_heating_val./(eng.plant.init.fuel_hot.map);
eng.tmp.max_trq         = interp1(eng.plant.init.trq_max_hot.idx1_spd,eng.plant.init.trq_max_hot.map,eng.plant.init.fuel_hot.idx1_spd);
eng.tmp.max_trq         = eng.tmp.max_trq(:)*ones(1,length(eng.plant.init.fuel_hot.idx2_trq));
eng.tmp.max_trq         = (eng.plant.init.fuel_hot.idx2_trq(:) * ones(1,length(eng.plant.init.fuel_hot.idx1_spd)))' > eng.tmp.max_trq;
eng.plant.init.eff_hot_pwr.map(eng.tmp.max_trq) = 0;
eng.plant.init.eff_max        = max(max(eng.plant.init.eff_hot_pwr.map));


%GASOLINE ENGINE zero fuel friction losses 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% engine off torque curve
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

eng.plant.init.trq_eng_off.idx1_spd = [0 104.67,122.71,140.76,158.80,176.85,194.90,212.94,230.99,249.03,267.08,285.13,303.17,321.22,339.26,357.31,375.36,393.40,411.45,429.49,447.54,465.59,483.63,501.68,519.72,537.77,555.82,573.86,591.91,609.95,628.00,]; % rad/s 
eng.plant.init.trq_eng_off.map = [0 -13.18,-13.69,-14.19,-14.67,-15.11,-15.64,-16.38,-17.44,-18.52,-19.38,-19.88,-20.33,-20.99,-21.99,-23.20,-24.53,-25.94,-27.37,-28.75,-30.09,-31.42,-32.75,-34.12,-35.53,-37.02,-38.58,-40.19,-41.84,-43.52,-45.23,]; % Nm 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Motoring torque
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

eng.plant.init.trq_zero_fuel_total_friction.idx1_spd = [ 104.67, 122.71, 140.76, 158.80, 176.85, 194.90, 212.94, 230.99, 249.03, 267.08, 285.13, 303.17, 321.22, 339.26, 357.31, 375.36, 393.40, 411.45, 429.49, 447.54, 465.59, 483.63, 501.68, 519.72, 537.77, 555.82, 573.86, 591.91, 609.95, 628.00,]; % rad/s 
eng.plant.init.trq_zero_fuel_total_friction.idx2_throttle = [  0.00,  2.56,  5.13,  7.69, 10.26, 12.82, 15.38, 17.95, 20.51, 23.08, 25.64, 28.21, 30.77, 33.33, 35.90, 38.46, 41.03, 43.59, 46.15, 48.72, 51.28, 53.85, 56.41, 58.97, 61.54, 64.10, 66.67, 69.23, 71.79, 74.36, 76.92, 79.49, 82.05, 84.62, 87.18, 89.74, 92.31, 94.87, 97.44, 100.00]/100;  % in the [0-1] range 
% Rows represent speed (rad/s).  Columns represent throttle (
eng.plant.init.trq_zero_fuel_total_friction.map = [...
-20.0037,-15.5388,-13.7854,-13.2645,-13.2092,-13.2696,-13.2862,-13.2626,-13.1658,-13.0050,-12.7949,-12.5514,-12.2895,-12.0208,-11.7537,-11.4944,-11.2478,-11.0176,-10.8071,-10.6191,-10.4556,-10.3185,-10.2089,-10.1279,-10.0765,-10.0553,-10.0649,-10.1058,-10.1784,-10.2828,-10.4192,-10.5877,-10.7894,-11.0260,-11.2998,-11.6131,-11.9656,-12.3521,-12.7617,-13.1815;...
-20.1206,-17.0801,-15.0210,-14.0405,-13.7559,-13.7567,-13.7988,-13.7896,-13.7079,-13.5667,-13.3859,-13.1815,-12.9638,-12.7404,-12.5173,-12.2999,-12.0925,-11.8991,-11.7225,-11.5651,-11.4286,-11.3143,-11.2232,-11.1562,-11.1140,-11.0973,-11.1067,-11.1426,-11.2055,-11.2959,-11.4139,-11.5595,-11.7324,-11.9321,-12.1585,-12.4119,-12.6935,-13.0038,-13.3391,-13.6882;...
-20.8252,-18.0155,-15.8823,-14.7429,-14.3917,-14.3439,-14.3480,-14.3314,-14.2509,-14.1268,-13.9781,-13.8146,-13.6413,-13.4623,-13.2823,-13.1061,-12.9380,-12.7812,-12.6385,-12.5116,-12.4019,-12.3103,-12.2377,-12.1846,-12.1517,-12.1395,-12.1486,-12.1794,-12.2327,-12.3089,-12.4082,-12.5304,-12.6746,-12.8386,-13.0196,-13.2156,-13.4268,-13.6577,-13.9137,-14.1911;...
-21.7240,-18.6229,-16.4746,-15.3265,-15.0386,-14.9804,-14.8984,-14.8693,-14.7886,-14.6882,-14.5780,-14.4572,-14.3267,-14.1897,-14.0509,-13.9149,-13.7854,-13.6652,-13.5561,-13.4595,-13.3763,-13.3071,-13.2527,-13.2133,-13.1896,-13.1820,-13.1909,-13.2167,-13.2601,-13.3216,-13.4015,-13.4997,-13.6151,-13.7450,-13.8850,-14.0297,-14.1754,-14.3237,-14.4853,-14.6725;...
-22.0427,-19.3362,-17.2341,-16.0248,-15.5604,-15.4357,-15.3863,-15.3555,-15.3156,-15.2632,-15.1969,-15.1162,-15.0239,-14.9254,-14.8257,-14.7287,-14.6372,-14.5529,-14.4769,-14.4099,-14.3525,-14.3053,-14.2685,-14.2427,-14.2281,-14.2250,-14.2338,-14.2547,-14.2883,-14.3348,-14.3946,-14.4678,-14.5537,-14.6504,-14.7536,-14.8561,-14.9479,-15.0203,-15.0717,-15.1123;...
-22.4360,-19.9709,-17.9022,-16.6818,-16.1658,-15.9932,-15.9283,-15.8874,-15.8833,-15.8745,-15.8447,-15.7958,-15.7360,-15.6725,-15.6101,-15.5511,-15.4965,-15.4470,-15.4028,-15.3643,-15.3317,-15.3054,-15.2857,-15.2728,-15.2671,-15.2686,-15.2775,-15.2938,-15.3177,-15.3494,-15.3888,-15.4364,-15.4919,-15.5550,-15.6232,-15.6905,-15.7443,-15.7644,-15.7287,-15.6367;...
-22.9544,-20.6583,-18.6571,-17.3989,-16.9229,-16.7291,-16.6124,-16.5385,-16.5408,-16.5441,-16.5275,-16.4983,-16.4658,-16.4354,-16.4089,-16.3863,-16.3670,-16.3503,-16.3361,-16.3242,-16.3148,-16.3082,-16.3046,-16.3041,-16.3069,-16.3129,-16.3221,-16.3343,-16.3492,-16.3667,-16.3864,-16.4086,-16.4335,-16.4618,-16.4939,-16.5281,-16.5568,-16.5616,-16.5113,-16.3828;...
-23.4308,-21.4620,-19.7110,-18.4950,-17.8626,-17.5679,-17.4297,-17.3592,-17.3126,-17.2752,-17.2456,-17.2266,-17.2189,-17.2204,-17.2282,-17.2396,-17.2526,-17.2659,-17.2788,-17.2912,-17.3030,-17.3145,-17.3258,-17.3368,-17.3476,-17.3581,-17.3678,-17.3764,-17.3833,-17.3880,-17.3897,-17.3883,-17.3839,-17.3778,-17.3724,-17.3716,-17.3792,-17.3961,-17.4175,-17.4354;...
-24.0192,-22.3440,-20.7205,-19.5448,-18.8608,-18.4787,-18.3035,-18.2398,-18.1311,-18.0430,-17.9969,-17.9880,-18.0045,-18.0358,-18.0745,-18.1159,-18.1570,-18.1963,-18.2329,-18.2667,-18.2974,-18.3251,-18.3498,-18.3714,-18.3897,-18.4043,-18.4148,-18.4205,-18.4206,-18.4144,-18.4007,-18.3790,-18.3490,-18.3120,-18.2713,-18.2349,-18.2178,-18.2444,-18.3439,-18.5229;...
-24.6557,-23.1668,-21.6107,-20.4181,-19.7282,-19.3385,-19.1119,-19.0416,-18.9153,-18.8185,-18.7814,-18.7920,-18.8327,-18.8897,-18.9537,-19.0193,-19.0832,-19.1438,-19.2003,-19.2520,-19.2990,-19.3408,-19.3774,-19.4084,-19.4334,-19.4519,-19.4633,-19.4669,-19.4617,-19.4467,-19.4208,-19.3831,-19.3333,-19.2720,-19.2028,-19.1347,-19.0853,-19.0855,-19.1758,-19.3772;...
-25.2609,-23.8025,-22.3689,-21.2181,-20.4574,-20.0248,-19.7943,-19.6891,-19.6285,-19.5991,-19.6065,-19.6471,-19.7108,-19.7875,-19.8698,-19.9528,-20.0335,-20.1103,-20.1822,-20.2486,-20.3088,-20.3626,-20.4093,-20.4484,-20.4794,-20.5015,-20.5140,-20.5161,-20.5070,-20.4856,-20.4509,-20.4021,-20.3386,-20.2612,-20.1723,-20.0782,-19.9894,-19.9208,-19.8850,-19.8783;...
-25.8589,-24.4828,-23.0558,-21.9484,-21.1735,-20.7307,-20.4955,-20.3814,-20.3819,-20.4244,-20.4847,-20.5577,-20.6410,-20.7311,-20.8244,-20.9178,-21.0092,-21.0971,-21.1801,-21.2575,-21.3282,-21.3915,-21.4464,-21.4923,-21.5283,-21.5536,-21.5673,-21.5688,-21.5571,-21.5315,-21.4913,-21.4357,-21.3645,-21.2777,-21.1761,-21.0599,-20.9278,-20.7717,-20.5750,-20.3267;...
-26.4489,-25.2062,-23.8819,-22.7824,-22.0650,-21.6008,-21.3644,-21.2501,-21.2682,-21.3439,-21.4347,-21.5286,-21.6235,-21.7198,-21.8171,-21.9146,-22.0111,-22.1051,-22.1952,-22.2800,-22.3582,-22.4285,-22.4897,-22.5409,-22.5809,-22.6090,-22.6241,-22.6256,-22.6128,-22.5850,-22.5419,-22.4831,-22.4081,-22.3163,-22.2055,-22.0705,-21.9002,-21.6758,-21.3749,-20.9936;...
-27.0388,-25.9366,-24.8498,-23.9069,-23.2112,-22.7421,-22.4692,-22.3426,-22.3309,-22.3876,-22.4727,-22.5652,-22.6584,-22.7519,-22.8466,-22.9426,-23.0393,-23.1352,-23.2284,-23.3172,-23.3999,-23.4747,-23.5401,-23.5950,-23.6381,-23.6684,-23.6850,-23.6872,-23.6744,-23.6462,-23.6024,-23.5427,-23.4663,-23.3716,-23.2544,-23.1065,-22.9150,-22.6653,-22.3510,-21.9915;...
-27.6858,-26.7856,-25.9220,-25.1489,-24.5201,-24.0600,-23.7617,-23.6013,-23.5444,-23.5556,-23.6045,-23.6711,-23.7462,-23.8268,-23.9121,-24.0017,-24.0943,-24.1881,-24.2809,-24.3704,-24.4544,-24.5310,-24.5985,-24.6554,-24.7004,-24.7324,-24.7506,-24.7541,-24.7425,-24.7153,-24.6725,-24.6134,-24.5372,-24.4416,-24.3223,-24.1726,-23.9846,-23.7537,-23.4853,-23.1974;...
-28.4317,-27.7520,-27.0861,-26.4587,-25.9101,-25.4787,-25.1753,-24.9840,-24.8769,-24.8286,-24.8216,-24.8437,-24.8864,-24.9443,-25.0138,-25.0921,-25.1767,-25.2648,-25.3536,-25.4403,-25.5226,-25.5983,-25.6655,-25.7227,-25.7685,-25.8017,-25.8214,-25.8268,-25.8173,-25.7926,-25.7521,-25.6953,-25.6212,-25.5281,-25.4134,-25.2750,-25.1123,-24.9293,-24.7336,-24.5338;...
-29.2815,-28.8169,-28.3302,-27.8159,-27.3310,-26.9398,-26.6539,-26.4495,-26.2914,-26.1766,-26.1053,-26.0739,-26.0759,-26.1041,-26.1523,-26.2150,-26.2876,-26.3662,-26.4472,-26.5278,-26.6051,-26.6771,-26.7417,-26.7974,-26.8427,-26.8764,-26.8976,-26.9054,-26.8991,-26.8781,-26.8419,-26.7897,-26.7210,-26.6353,-26.5331,-26.4168,-26.2921,-26.1674,-26.0506,-25.9425;...
-30.2266,-29.9509,-29.6262,-29.2025,-28.7601,-28.4110,-28.1540,-27.9536,-27.7429,-27.5646,-27.4328,-27.3495,-27.3096,-27.3053,-27.3285,-27.3714,-27.4279,-27.4930,-27.5625,-27.6332,-27.7024,-27.7677,-27.8273,-27.8796,-27.9232,-27.9568,-27.9794,-27.9901,-27.9881,-27.9726,-27.9429,-27.8987,-27.8399,-27.7676,-27.6848,-27.5972,-27.5132,-27.4429,-27.3948,-27.3695;...
-31.2805,-31.1075,-30.8845,-30.5923,-30.2282,-29.8953,-29.6432,-29.4207,-29.1828,-28.9616,-28.7845,-28.6589,-28.5819,-28.5460,-28.5421,-28.5619,-28.5983,-28.6456,-28.6996,-28.7567,-28.8143,-28.8702,-28.9224,-28.9694,-29.0099,-29.0427,-29.0667,-29.0809,-29.0844,-29.0764,-29.0563,-29.0239,-28.9801,-28.9269,-28.8688,-28.8123,-28.7659,-28.7381,-28.7345,-28.7522;...
-32.3966,-32.2917,-32.1538,-31.9559,-31.6907,-31.3992,-31.1204,-30.8531,-30.5912,-30.3493,-30.1471,-29.9935,-29.8877,-29.8232,-29.7918,-29.7857,-29.7982,-29.8237,-29.8581,-29.8980,-29.9407,-29.9842,-30.0266,-30.0666,-30.1028,-30.1341,-30.1594,-30.1777,-30.1881,-30.1899,-30.1825,-30.1663,-30.1422,-30.1129,-30.0825,-30.0567,-30.0418,-30.0429,-30.0608,-30.0895;...
-33.5090,-33.5063,-33.4685,-33.3570,-33.1566,-32.8843,-32.5779,-32.2707,-31.9832,-31.7294,-31.5174,-31.3495,-31.2233,-31.1338,-31.0749,-31.0407,-31.0259,-31.0260,-31.0370,-31.0561,-31.0808,-31.1092,-31.1397,-31.1708,-31.2015,-31.2306,-31.2572,-31.2802,-31.2990,-31.3128,-31.3214,-31.3250,-31.3247,-31.3225,-31.3214,-31.3248,-31.3358,-31.3557,-31.3835,-31.4151;...
-34.5846,-34.7478,-34.8433,-34.8104,-34.6368,-34.3528,-34.0127,-33.6729,-33.3693,-33.1140,-32.9025,-32.7283,-32.5866,-32.4740,-32.3874,-32.3235,-32.2787,-32.2500,-32.2345,-32.2297,-32.2336,-32.2444,-32.2608,-32.2816,-32.3057,-32.3321,-32.3599,-32.3883,-32.4167,-32.4445,-32.4716,-32.4980,-32.5243,-32.5516,-32.5807,-32.6124,-32.6465,-32.6820,-32.7172,-32.7518;...
-35.6254,-36.0163,-36.2697,-36.2983,-36.1222,-35.8107,-35.4347,-35.0658,-34.7653,-34.5212,-34.3143,-34.1341,-33.9765,-33.8403,-33.7250,-33.6297,-33.5529,-33.4930,-33.4482,-33.4169,-33.3975,-33.3887,-33.3894,-33.3984,-33.4149,-33.4380,-33.4670,-33.5013,-33.5403,-33.5836,-33.6309,-33.6821,-33.7370,-33.7952,-33.8556,-33.9167,-33.9757,-34.0297,-34.0768,-34.1185;...
-36.7011,-37.3054,-37.6909,-37.7602,-37.5795,-37.2626,-36.8738,-36.4794,-36.2035,-35.9715,-35.7625,-35.5697,-35.3917,-35.2292,-35.0833,-34.9549,-34.8443,-34.7513,-34.6753,-34.6155,-34.5710,-34.5409,-34.5243,-34.5205,-34.5286,-34.5480,-34.5782,-34.6186,-34.6688,-34.7284,-34.7970,-34.8740,-34.9585,-35.0488,-35.1424,-35.2358,-35.3250,-35.4059,-35.4757,-35.5345;...
-38.0187,-38.5581,-38.9425,-39.0864,-38.9740,-38.7118,-38.3703,-38.0173,-37.7233,-37.4769,-37.2503,-37.0350,-36.8303,-36.6374,-36.4583,-36.2951,-36.1492,-36.0216,-35.9129,-35.8231,-35.7521,-35.6994,-35.6646,-35.6470,-35.6462,-35.6616,-35.6927,-35.7393,-35.8008,-35.8770,-35.9673,-36.0705,-36.1853,-36.3090,-36.4381,-36.5685,-36.6953,-36.8144,-36.9236,-37.0249;...
-39.4013,-39.8195,-40.1574,-40.3382,-40.3290,-40.1658,-39.9059,-39.6066,-39.3104,-39.0348,-38.7758,-38.5280,-38.2898,-38.0620,-37.8467,-37.6466,-37.4638,-37.3005,-37.1581,-37.0374,-36.9390,-36.8629,-36.8091,-36.7772,-36.7670,-36.7780,-36.8099,-36.8625,-36.9353,-37.0279,-37.1396,-37.2690,-37.4143,-37.5728,-37.7405,-37.9132,-38.0862,-38.2555,-38.4196,-38.5802;...
-40.7149,-41.0787,-41.4023,-41.6245,-41.7038,-41.6384,-41.4596,-41.2084,-40.9205,-40.6232,-40.3298,-40.0442,-39.7672,-39.5003,-39.2456,-39.0063,-38.7852,-38.5852,-38.4083,-38.2562,-38.1299,-38.0300,-37.9567,-37.9101,-37.8901,-37.8965,-37.9290,-37.9874,-38.0712,-38.1799,-38.3125,-38.4679,-38.6440,-38.8384,-39.0476,-39.2680,-39.4953,-39.7257,-39.9568,-40.1875;...
-41.9058,-42.3211,-42.7000,-42.9851,-43.1364,-43.1438,-43.0244,-42.8091,-42.5315,-42.2214,-41.8993,-41.5764,-41.2583,-40.9490,-40.6521,-40.3715,-40.1108,-39.8733,-39.6616,-39.4777,-39.3233,-39.1993,-39.1064,-39.0449,-39.0150,-39.0165,-39.0494,-39.1133,-39.2078,-39.3321,-39.4853,-39.6663,-39.8734,-40.1047,-40.3578,-40.6299,-40.9180,-41.2182,-41.5262,-41.8373;...
-42.9609,-43.5525,-44.0542,-44.4200,-44.6319,-44.6864,-44.5991,-44.4034,-44.1344,-43.8183,-43.4743,-43.1172,-42.7578,-42.4044,-42.0633,-41.7400,-41.4387,-41.1631,-40.9163,-40.7006,-40.5179,-40.3698,-40.2571,-40.1806,-40.1407,-40.1374,-40.1705,-40.2398,-40.3446,-40.4842,-40.6577,-40.8641,-41.1023,-41.3711,-41.6695,-41.9959,-42.3486,-42.7244,-43.1179,-43.5207;...
-43.9030,-44.8003,-45.4509,-45.8989,-46.1687,-46.2563,-46.1799,-45.9898,-45.7301,-45.4123,-45.0502,-44.6609,-44.2606,-43.8625,-43.4764,-43.1096,-42.7673,-42.4535,-42.1714,-41.9238,-41.7130,-41.5406,-41.4082,-41.3168,-41.2668,-41.2585,-41.2918,-41.3664,-41.4814,-41.6362,-41.8298,-42.0615,-42.3309,-42.6375,-42.9817,-43.3633,-43.7820,-44.2359,-44.7204,-45.2256;...
].*(eng.plant.init.displ_init/2000);% Nm 


% End of all fuel off trq calculations

%% Throttle position with fuel off as a fraction, i.e. 5% throttle will be 0.05
eng.plant.init.throttle_position_fuel_off = 0.05; % this can be a lookup table as a function of speed.

%%
clear Idx F;   

eng = rmfield(eng,'tmp');